<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <meta http-equiv="X-UA-Compatible" content="ie=edge" />
</head>

<body>

      <form class="form">
            <input class="" type="search" id="search-input" placeholder="Search">
            <button class= "" type="submit" id="search">Search</button>
        </form>

        <div id="brewery-list" 
            style="
               margin:10px; 
               padding:5px; 
               font-family: georgia; 
               font-size: 12px; 
               line-height: 30px;">
         </div>

   <div id="map" style="width: 500px; height: 400px; display: none;"></div>
   <button id="button" h= "39.8" v= "-104.8">view map</button>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>

var map;
var la= 39.7392
var ln= -104.9903

var initMap = function() {
    map = new google.maps.Map(document.getElementById("map"), {
       center: {lat: la, lng: ln},
       zoom: 15
   });
   var marker = new google.maps.Marker({
   position: {lat: la, lng: ln},
   map: map
 });
}

$("#button").on("click", function(){
  la= parseFloat($(this).attr("h"), 10);
  ln= parseFloat($(this).attr("v"), 10);
  (document.getElementById("map")).style.display = "block";
  map = new google.maps.Map(document.getElementById("map"), {
       center: {lat: la, lng: ln},
       zoom: 15
   });
   var marker = new google.maps.Marker({
   position: {lat: la, lng: ln},
   map: map
 });
});

////////////////////////beer api/////////////////////////

$("#search").on('click', function () {
    event.preventDefault();
    // console.log("button was clicked");

    var cityInput = $('#search-input').val();
    // cityInput = cityInput.split(' ');
    // cityInput = cityInput.join('-');
    console.log("city input: " + cityInput);


var APIkey = "cd3220993a88c09168f7e658ad27b100";
var breweryQuery ="http://beermapping.com/webservice/loccity/" + APIkey + "/" + cityInput + "&s=json";
var mapQuery = "https://beermapping.com/?lat=41.91034&lon=-87.67597&z=5"

//call brewery API
$.ajax({
      url: breweryQuery,
      method: "GET"
    }).then(function (response) {

      console.log(breweryQuery);

      for(var i = 0; i < 20; i++ ){
         
         //get random brewery
         var rb = response[Math.floor(Math.random() * response.length)];

         //random brewery address
         var rbAddress = (rb.street + " " + rb.city + " " + rb.state);

         //random brewery website
         var URLstring = ""
         var URLstring = JSON.stringify(rb.url);
         var newURLstring = URLstring.substring(1, URLstring.length);
         var rbURL = '<a target= "blank" href="https://' + newURLstring +  ">visit their website</a>" ;

         //google geocoding API//
         //get coordinates for random brewery for geocode//
         googleAPIkey = "AIzaSyAP6OXI1t3xgoiRrS2RrYY-pmOjKYFnyNU"
         geocodeURL = "https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway+Mountain+View+CA&key=" + googleAPIkey;

         gAddress = rbAddress.split(' ');
         gAddress = gAddress.join('+');
        //  console.log("create address for geocode: " + gAddress)
         breweryGeocodeURL = "https://maps.googleapis.com/maps/api/geocode/json?address=" + gAddress + "&key=" + googleAPIkey;

         $.ajax({
               url: breweryGeocodeURL,
               method: "GET"
            }).then(function (gresponse) {
               // console.log("google geocode api working: " + breweryGeocodeURL);
               // console.log(gresponse.results[0].geometry.location.lat);

               var cityLat = gresponse.results[0].geometry.location.lat;
               var cityLon = gresponse.results[0].geometry.location.lng;

               //console log random brewery info
                // console.log("Name: " + rb.name + " | URL: " + rb.url + " | Address: " + rbAddress + "coordinates: " + cityLat + "," + cityLon);
                
            });

            console.log("Name: " + rb.name + " | Address: " + rbAddress + " | Website: " + rb.url);
            $("#brewery-list").append("<b>" + rb.name + "</b> | " + rbAddress + " | " + rbURL + "<br>");

         }

    });

});






</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAP6OXI1t3xgoiRrS2RrYY-pmOjKYFnyNU&callback=initMap" async defer></script>
</body>